# Функциональность кредитов и кредитных карт

## Обзор

Добавлена новая функциональность для управления кредитами и кредитными картами в финансовом приложении. Пользователи могут отслеживать свои кредиты, платежи, льготные периоды и задолженности.

## Функции

### Кредиты

#### Возможности:
- Добавление новых кредитов через модальное окно
- Отслеживание основной суммы, процентной ставки, срока
- Запись платежей и автоматический пересчет остатка
- Отображение прогресса погашения кредита
- Расчет оставшегося количества месяцев до полного погашения

#### Поля для добавления кредита:
- **Основная сумма** (грн) - первоначальная сумма кредита
- **Процентная ставка** (%) - годовая процентная ставка
- **Срок в месяцах** - общий срок кредита
- **Дата открытия** - дата получения кредита
- **Ежемесячный платеж** (грн) - фиксированный ежемесячный платеж

#### Отображаемая информация:
- ID кредита и дата открытия
- Основная сумма и процентная ставка
- Срок кредита и ежемесячный платеж
- Сумма уже оплаченная и остаток задолженности
- Процент погашения кредита (прогресс-бар)
- Примерное количество месяцев до полного погашения

### Кредитные карты

#### Возможности:
- Добавление кредитных карт с настройкой льготного периода
- Отслеживание дней выписки и платежа
- Мониторинг статуса льготного периода
- Отображение текущей задолженности
- Подсчет дней до следующего платежа

#### Поля для добавления карты:
- **Название карты** - название или номер карты
- **Льготный период** (дней) - количество дней льготного периода
- **День выписки** (1-31, опционально) - день месяца формирования выписки
- **День платежа** (1-31, опционально) - день месяца, когда нужно внести платеж
- **Текущая задолженность** (грн) - текущий баланс по карте

#### Отображаемая информация:
- Название карты и ID
- Льготный период в днях
- Дни выписки и платежа (если указаны)
- Текущая задолженность
- Статус льготного периода:
  - "Льготный период активен" (зеленый) - если до платежа больше дней, чем льготный период
  - "Льготный период истек" (красный) - если льготный период закончился
  - "Платеж просрочен" (красный) - если дата платежа уже прошла
- Количество дней до следующего платежа с цветовой индикацией

## API Endpoints

### Кредиты

#### GET /api/get-loans
Получение списка всех кредитов пользователя.

#### POST /api/add-loan
Добавление нового кредита.
**Параметры:**
- `principal` - основная сумма (number)
- `interest_rate` - процентная ставка (number)
- `term_months` - срок в месяцах (number)
- `start_date` - дата открытия (string, YYYY-MM-DD)
- `monthly_payment` - ежемесячный платеж (number)

#### PUT /api/update-loan
Обновление данных кредита.
**Параметры:**
- `id` - ID кредита (number)
- `paid_amount` - сумма оплаченная (number, опционально)
- `remaining_balance` - остаток задолженности (number, опционально)

#### POST /api/record-loan-payment
Запись платежа по кредиту.
**Параметры:**
- `loan_id` - ID кредита (number)
- `payment_amount` - сумма платежа (number)

### Кредитные карты

#### GET /api/get-credit-cards
Получение списка всех кредитных карт пользователя.

#### POST /api/add-credit-card
Добавление новой кредитной карты.
**Параметры:**
- `card_name` - название карты (string)
- `grace_period_days` - льготный период в днях (number)
- `statement_day` - день выписки (number, опционально)
- `payment_due_day` - день платежа (number, опционально)
- `unpaid_balance` - текущая задолженность (number, опционально)

#### PUT /api/update-credit-card
Обновление данных кредитной карты.
**Параметры:**
- `id` - ID карты (number)
- `card_name` - название карты (string, опционально)
- `grace_period_days` - льготный период в днях (number, опционально)
- `statement_day` - день выписки (number, опционально)
- `payment_due_day` - день платежа (number, опционально)
- `unpaid_balance` - текущая задолженность (number, опционально)

## База данных

### Таблица `loans`
```sql
CREATE TABLE public.loans (
  id serial NOT NULL,
  principal numeric(15, 2) NOT NULL,
  interest_rate numeric(5, 2) NOT NULL,
  term_months integer NOT NULL,
  start_date date NOT NULL,
  monthly_payment numeric(15, 2) NOT NULL,
  remaining_balance numeric(15, 2) NOT NULL,
  created_at timestamp without time zone NULL DEFAULT now(),
  paid_amount numeric(15, 2) NOT NULL DEFAULT 0.00,
  CONSTRAINT loans_pkey PRIMARY KEY (id)
);
```

### Таблица `credit_cards`
```sql
CREATE TABLE public.credit_cards (
  id serial NOT NULL,
  card_name character varying(255) NOT NULL,
  grace_period_days integer NOT NULL,
  statement_day integer NULL,
  payment_due_day integer NULL,
  unpaid_balance numeric(15, 2) NULL DEFAULT 0,
  created_at timestamp without time zone NULL DEFAULT now(),
  CONSTRAINT credit_cards_pkey PRIMARY KEY (id),
  CONSTRAINT credit_cards_payment_due_day_check CHECK (
    (payment_due_day >= 1) AND (payment_due_day <= 31)
  ),
  CONSTRAINT credit_cards_statement_day_check CHECK (
    (statement_day >= 1) AND (statement_day <= 31)
  )
);
```

## Использование

1. **Добавление кредита:**
   - Нажмите кнопку "Добавить кредит" в секции "Мои кредиты"
   - Заполните все обязательные поля в модальном окне
   - Нажмите "Сохранить"

2. **Запись платежа по кредиту:**
   - В карточке кредита введите сумму платежа в поле "Сумма платежа"
   - Нажмите кнопку "Записать платеж"
   - Система автоматически обновит остаток и прогресс погашения

3. **Добавление кредитной карты:**
   - Нажмите кнопку "Добавить карту" в секции "Кредитные карты"
   - Заполните обязательные поля (название и льготный период)
   - При желании укажите дни выписки и платежа
   - Нажмите "Сохранить"

4. **Мониторинг льготного периода:**
   - Система автоматически рассчитывает статус льготного периода
   - Цветовая индикация показывает срочность платежа
   - Отображается количество дней до следующего платежа

## Особенности

- Все суммы отображаются в гривнах (грн)
- Даты отображаются в формате ДД.ММ.ГГГГ
- Прогресс-бары показывают процент погашения кредитов
- Автоматический пересчет остатков при записи платежей
- Валидация данных на клиенте и сервере
- Адаптивный дизайн для мобильных устройств 