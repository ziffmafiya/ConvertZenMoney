# Net Worth (Чистая стоимость) - Руководство по установке и использованию

## Обзор

Функциональность Net Worth позволяет автоматически рассчитывать чистую стоимость активов (активы минус обязательства) с визуализацией в виде графиков и детализированным отображением. Система интегрирована с существующими кредитами и кредитными картами для автоматической синхронизации данных.

## Установка

### 1. Создание таблиц в базе данных

Выполните SQL скрипт `create_net_worth_tables.sql` в вашей базе данных Supabase:

```sql
-- Выполните содержимое файла create_net_worth_tables.sql
```

Этот скрипт создаст следующие таблицы:
- `assets` - для хранения активов
- `liabilities` - для хранения обязательств  
- `net_worth_history` - для отслеживания истории изменений

### 2. API Endpoints

#### Основной API для Net Worth (`api/net-worth.js`)
- **GET** `/api/net-worth?action=summary` - получение сводки
- **GET** `/api/net-worth?action=history&period=6months` - получение истории
- **GET** `/api/net-worth?action=assets` - получение активов
- **GET** `/api/net-worth?action=liabilities` - получение обязательств
- **GET** `/api/net-worth?action=detailed` - получение детальной информации
- **POST** `/api/net-worth` - добавление актива или обязательства
- **PUT** `/api/net-worth` - обновление актива или обязательства
- **DELETE** `/api/net-worth?type=asset&id=1` - удаление актива
- **DELETE** `/api/net-worth?type=liability&id=1` - удаление обязательства

#### API для синхронизации (`api/sync-net-worth.js`)
- **POST** `/api/sync-net-worth` - синхронизация кредитов и кредитных карт

#### API для интеграции с существующими кредитами (`api/sync-existing-loans.js`)
- **POST** `/api/sync-existing-loans` - синхронизация существующих кредитов и получение сводки

### 3. UI Компоненты

В файл `index.html` уже добавлены:
- Секция Net Worth с основными метриками
- График истории Net Worth
- Списки активов и обязательств
- Секция сводки по существующим кредитам
- Модальные окна для добавления/редактирования
- JavaScript логика для взаимодействия с API

## Использование

### Интеграция с существующими кредитами

#### Автоматическая синхронизация кредитов
1. Нажмите кнопку "Синхронизировать кредиты" в секции Net Worth
2. Подтвердите действие в диалоговом окне
3. Система автоматически:
   - Получит все кредиты из таблицы `loans`
   - Создаст соответствующие обязательства в Net Worth
   - Обновит историю Net Worth
   - Покажет результаты синхронизации

#### Просмотр сводки по кредитам
В отдельной секции "Сводка по кредитам" отображается:
- **Всего кредитов** - количество активных кредитов
- **Общий долг** - сумма всех оставшихся балансов
- **Ежемесячные платежи** - общая сумма ежемесячных платежей
- **Средняя ставка** - средняя процентная ставка по всем кредитам

#### Детализация кредитов
Для каждого кредита показывается:
- Номер кредита и оставшийся баланс
- Основная сумма кредита
- Ежемесячный платеж
- Процентная ставка
- Срок кредита в месяцах
- Дата начала кредита
- Сумма уже оплаченная (если есть)

### Добавление активов

1. Нажмите кнопку "Добавить актив" в секции Net Worth
2. Заполните форму:
   - **Название актива** - например, "Накопления в банке"
   - **Тип актива** - выберите из списка (наличные, инвестиции, недвижимость, транспорт, другое)
   - **Стоимость** - укажите стоимость в гривнах
   - **Описание** - опционально
3. Нажмите "Добавить"

### Добавление обязательств

1. Нажмите кнопку "Добавить долг" в секции Net Worth
2. Заполните форму:
   - **Название обязательства** - например, "Кредит на автомобиль"
   - **Тип обязательства** - выберите из списка (кредит, кредитная карта, ипотека, другое)
   - **Сумма долга** - укажите сумму в гривнах
   - **Описание** - опционально
3. Нажмите "Добавить"

### Просмотр Net Worth

После добавления активов и обязательств вы увидите:

1. **Основные метрики**:
   - Общие активы (зеленым цветом)
   - Общие обязательства (красным цветом)
   - Net Worth (синим/зеленым/красным в зависимости от значения)

2. **График истории**:
   - Линейный график с тремя линиями: Net Worth, Активы, Обязательства
   - Кнопки для выбора периода: 1 месяц, 3 месяца, 6 месяцев, 1 год

3. **Детализация**:
   - Список всех активов с возможностью редактирования и удаления
   - Список всех обязательств с возможностью редактирования и удаления

### Редактирование и удаление

- Нажмите "Изменить" рядом с активом или обязательством для редактирования
- Нажмите "Удалить" для удаления (с подтверждением)

## Типы активов и обязательств

### Активы:
- **Наличные деньги** - наличные средства, депозиты
- **Инвестиции** - акции, облигации, криптовалюты
- **Недвижимость** - квартиры, дома, земля
- **Транспорт** - автомобили, мотоциклы
- **Другое** - прочие активы

### Обязательства:
- **Кредит** - банковские кредиты
- **Кредитная карта** - задолженность по кредитным картам
- **Ипотека** - ипотечные кредиты
- **Другое** - прочие долги

## Автоматические функции

### История изменений
При каждом добавлении, изменении или удалении актива/обязательства автоматически создается запись в таблице `net_worth_history` для построения графиков.

### Расчет Net Worth
Net Worth рассчитывается автоматически как: `Общие активы - Общие обязательства`

### Цветовая индикация
- **Зеленый** - положительный Net Worth
- **Красный** - отрицательный Net Worth  
- **Синий** - нулевой Net Worth

### Интеграция с существующими данными
- **Автоматическая синхронизация кредитов** - все кредиты из таблицы `loans` автоматически добавляются как обязательства
- **Обновление данных** - при повторной синхронизации существующие записи обновляются
- **Детальная информация** - в описании обязательства сохраняется полная информация о кредите

## API Endpoints

### Получение данных

```javascript
// Сводка Net Worth
fetch('/api/net-worth?action=summary')

// История Net Worth
fetch('/api/net-worth?action=history&period=6months')

// Все активы
fetch('/api/net-worth?action=assets')

// Все обязательства
fetch('/api/net-worth?action=liabilities')

// Детальная информация
fetch('/api/net-worth?action=detailed')

// Сводка по существующим кредитам
fetch('/api/sync-existing-loans', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ action: 'get_loans_summary' })
})
```

### Добавление

```javascript
// Добавление актива
fetch('/api/net-worth', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        type: 'asset',
        data: {
            name: 'Накопления',
            type: 'cash',
            value: 100000,
            description: 'Депозит в банке'
        }
    })
})

// Добавление обязательства
fetch('/api/net-worth', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        type: 'liability',
        data: {
            name: 'Кредит на авто',
            type: 'loan',
            amount: 50000,
            description: 'Автокредит'
        }
    })
})
```

### Обновление

```javascript
fetch('/api/net-worth', {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        type: 'asset',
        id: 1,
        data: {
            name: 'Обновленное название',
            value: 150000
        }
    })
})
```

### Удаление

```javascript
// Удаление актива
fetch('/api/net-worth?type=asset&id=1', { method: 'DELETE' })

// Удаление обязательства
fetch('/api/net-worth?type=liability&id=1', { method: 'DELETE' })
```

### Синхронизация

```javascript
// Синхронизация существующих кредитов
fetch('/api/sync-existing-loans', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ action: 'sync_existing_loans' })
})

// Синхронизация кредитов
fetch('/api/sync-net-worth', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ action: 'sync_loans' })
})

// Синхронизация кредитных карт
fetch('/api/sync-net-worth', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ action: 'sync_credit_cards' })
})

// Синхронизация всех данных
fetch('/api/sync-net-worth', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ action: 'sync_all' })
})
```

## Структура базы данных

### Таблица `assets`
```sql
CREATE TABLE assets (
  id SERIAL PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  type VARCHAR(100) NOT NULL,
  value NUMERIC(15,2) NOT NULL,
  currency VARCHAR(3) DEFAULT 'UAH',
  description TEXT,
  last_updated TIMESTAMP DEFAULT NOW(),
  created_at TIMESTAMP DEFAULT NOW()
);
```

### Таблица `liabilities`
```sql
CREATE TABLE liabilities (
  id SERIAL PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  type VARCHAR(100) NOT NULL,
  amount NUMERIC(15,2) NOT NULL,
  currency VARCHAR(3) DEFAULT 'UAH',
  description TEXT,
  last_updated TIMESTAMP DEFAULT NOW(),
  created_at TIMESTAMP DEFAULT NOW()
);
```

### Таблица `net_worth_history`
```sql
CREATE TABLE net_worth_history (
  id SERIAL PRIMARY KEY,
  total_assets NUMERIC(15,2) NOT NULL,
  total_liabilities NUMERIC(15,2) NOT NULL,
  net_worth NUMERIC(15,2) NOT NULL,
  currency VARCHAR(3) DEFAULT 'UAH',
  recorded_at TIMESTAMP DEFAULT NOW()
);
```

### Интеграция с существующей таблицей `loans`
Система автоматически интегрируется с существующей таблицей `loans`, которая должна содержать следующие поля:
- `id` - уникальный идентификатор кредита
- `principal` - основная сумма кредита
- `remaining_balance` - оставшийся баланс
- `monthly_payment` - ежемесячный платеж
- `interest_rate` - процентная ставка
- `term_months` - срок кредита в месяцах
- `start_date` - дата начала кредита
- `paid_amount` - сумма уже оплаченная (опционально)

## Синхронизация с существующими данными

### Автоматическая синхронизация

Функциональность Net Worth включает возможность автоматической синхронизации с существующими кредитами и кредитными картами:

1. **Синхронизация существующих кредитов** - автоматически добавляет все кредиты из таблицы `loans` как обязательства
2. **Синхронизация кредитов** - автоматически добавляет все кредиты как обязательства
3. **Синхронизация кредитных карт** - автоматически добавляет задолженности по кредитным картам из таблицы `credit_cards`
4. **Синхронизация всех данных** - выполняет все операции одновременно

### Использование синхронизации

1. **Синхронизация существующих кредитов**:
   - Нажмите кнопку "Синхронизировать кредиты" в секции Net Worth
   - Подтвердите действие
   - Просмотрите результаты синхронизации

2. **Общая синхронизация**:
   - Нажмите кнопку "Синхронизировать" в секции Net Worth
   - Выберите тип синхронизации:
     - **Кредиты** - синхронизирует только кредиты
     - **Кредитные карты** - синхронизирует только кредитные карты
     - **Все данные** - синхронизирует и кредиты, и кредитные карты
   - Просмотрите результаты синхронизации

### Логика синхронизации

- **Существующие кредиты**: создаются обязательства типа 'loan' с названием "Кредит #ID" и суммой равной оставшемуся балансу
- **Кредиты**: создаются обязательства типа 'loan' с названием "Кредит #ID" и суммой равной оставшемуся балансу
- **Кредитные карты**: создаются обязательства типа 'credit_card' с названием "Кредитная карта: [название карты]" и суммой равной неоплаченному балансу
- **Дублирование**: система автоматически определяет существующие записи и обновляет их вместо создания дубликатов
- **История**: после каждой синхронизации автоматически обновляется история Net Worth

### Детальная информация в обязательствах

При синхронизации в описании обязательства сохраняется полная информация:
- Основная сумма кредита
- Процентная ставка
- Срок кредита
- Ежемесячный платеж
- Идентификатор исходного кредита для связи

## Возможные улучшения

1. **Экспорт данных** - возможность экспорта Net Worth в PDF или Excel
2. **Уведомления** - уведомления о значительных изменениях Net Worth
3. **Цели** - установка целей по Net Worth с отслеживанием прогресса
4. **Мультивалютность** - поддержка разных валют с конвертацией
5. **Категоризация** - более детальная категоризация активов и обязательств
6. **Автоматическая синхронизация** - регулярная автоматическая синхронизация по расписанию
7. **Аналитика** - расширенная аналитика и прогнозирование Net Worth
8. **Интеграция с банками** - автоматическое получение данных о кредитах и депозитах
9. **Мобильное приложение** - разработка мобильного приложения для отслеживания Net Worth
10. **Уведомления о платежах** - напоминания о предстоящих платежах по кредитам 