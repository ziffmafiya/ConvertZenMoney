<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Универсальный Финансовый Отчет</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Tektur:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/i18next/dist/umd/i18next.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="antialiased bg-[#0D1117] text-[#c9d1d9]">

    <div class="container mx-auto p-4 md:p-8"> <!-- Increased max-width -->

        <!-- Секция заголовка -->
        <header class="flex flex-wrap justify-between items-center gap-6 mb-8 md:mb-12">
            <!-- Actions -->
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-2" id="quickFilters">
                </div>
            </div>
            <div class="flex items-center gap-4">
                <button id="settingsButton" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">
                    Настройки
                </button>
            </div>
        </header>

        <!-- Секция фильтров -->
        <div class="mb-8 md:mb-12">
             <div class="flex items-center gap-2 p-4 bg-[#161b22] rounded-lg border border-[#30363d]">
                <select id="filterMonth" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                    <option value="">Весь год</option>
                    <option value="01">Январь</option>
                    <option value="02">Февраль</option>
                    <option value="03">Март</option>
                    <option value="04">Апрель</option>
                    <option value="05">Май</option>
                    <option value="06">Июнь</option>
                    <option value="07">Июль</option>
                    <option value="08">Август</option>
                    <option value="09">Сентябрь</option>
                    <option value="10">Октябрь</option>
                    <option value="11">Ноябрь</option>
                    <option value="12">Декабрь</option>
                </select>
                <input type="number" id="filterYear" placeholder="Год" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
            </div>
        </div>

        <!-- Секция основных метрик -->
        <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-8 mb-8 md:mb-12">
            <!-- Карточка актуального баланса -->
            <div class="bg-[#161b22] rounded-2xl p-6 text-left transition-all duration-300 border border-[#30363d] hover:translate-y-[-5px] hover:shadow-lg hover:shadow-black/30 hover:border-[#8b5cf6]">
                <h3 class="text-2xl font-bold text-white mb-2">Актуальный баланс</h3>
                <p id="headerNetBalance" class="text-4xl font-bold text-white">0.00 грн</p>
                <div class="flex items-center gap-2 mt-2">
                    <span id="netBalanceChange" class="text-sm font-semibold"></span>
                    <div class="h-8 w-24"><canvas id="netBalanceSparkline"></canvas></div>
                </div>
            </div>
             <!-- Карточка общего дохода -->
            <div class="bg-[#161b22] rounded-2xl p-6 text-left transition-all duration-300 border border-[#30363d] hover:translate-y-[-5px] hover:shadow-lg hover:shadow-black/30 hover:border-[#8b5cf6]">
                <h3 class="text-2xl font-bold text-white mb-2">Общий доход</h3>
                <p id="totalIncome" class="text-4xl font-bold text-green-400">0.00 грн</p>
                <div class="flex items-center gap-2 mt-2">
                    <span id="incomeChange" class="text-sm font-semibold"></span>
                    <div class="h-8 w-24"><canvas id="incomeSparkline"></canvas></div>
                </div>
            </div>
            <!-- Карточка общих расходов -->
            <div class="bg-[#161b22] rounded-2xl p-6 text-left transition-all duration-300 border border-[#30363d] hover:translate-y-[-5px] hover:shadow-lg hover:shadow-black/30 hover:border-[#8b5cf6]">
                <h3 class="text-2xl font-bold text-white mb-2">Общие расходы</h3>
                <div>
                    <p id="totalExpenses" class="text-4xl font-bold text-red-400">0.00 грн</p>
                    <div class="flex items-center gap-2 mt-2">
                        <span id="expensesChange" class="text-sm font-semibold"></span>
                        <div class="h-8 w-24"><canvas id="expensesSparkline"></canvas></div>
                    </div>
                </div>
                <p id="expensesToIncomeText" class="text-center text-gray-400 text-sm mt-2"></p>
            </div>
            <!-- Карточка теоретических сбережений -->
            <div class="bg-[#161b22] rounded-2xl p-6 text-left transition-all duration-300 border border-[#30363d] hover:translate-y-[-5px] hover:shadow-lg hover:shadow-black/30 hover:border-[#8b5cf6]">
                <h3 class="text-2xl font-bold text-white mb-2">Теоретические сбережения (20%)</h3>
                <p id="theoreticalSavings" class="text-4xl font-bold text-blue-400">0.00 грн</p>
                <p class="text-gray-400 text-sm mt-2">20% от общего дохода</p>
            </div>
        </section>

        <!-- Новая карточка: Расходы по категориям и сравнение -->
        <section class="bg-[#161b22] rounded-2xl p-6 text-left transition-all duration-300 border border-[#30363d] hover:translate-y-[-5px] hover:shadow-lg hover:shadow-black/30 hover:border-[#8b5cf6] mb-8 md:mb-12">
            <div class="flex flex-wrap justify-between items-start mb-4">
                <div>
                    <h2 class="text-2xl font-bold text-white" id="topExpensesCardTitle">Расходы за 1-31 июля</h2>
                    <p class="text-gray-400 text-sm" id="topExpensesCardSubtitle">Сравниваем с 1-30 июня</p>
                </div>
                <div class="text-right">
                    <p class="text-4xl font-bold text-white" id="topExpensesTotal">27 371 ₴</p>
                    <p class="text-sm font-semibold text-green-400" id="topExpensesChange">▼ 8 446 ₴ (24%)</p>
                </div>
            </div>
            <div class="flex flex-col lg:flex-row items-center gap-4">
                <div class="w-full lg:w-1/2 h-48">
                    <canvas id="topExpensesTrendChart"></canvas>
                </div>
                <div class="w-full lg:w-1/2 space-y-4" id="topExpensesCategoriesList">
                    <!-- Категории будут здесь -->
                </div>
            </div>
        </section>

        <!-- Секция детализации с вкладками -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-12 mb-8 md:mb-12">
            
            <!-- Карточка детализации расходов -->
            <div class="bg-[#161b22] rounded-2xl p-6 text-left transition-all duration-300 border border-[#30363d] hover:translate-y-[-5px] hover:shadow-lg hover:shadow-black/30 hover:border-[#8b5cf6]">
                <div class="mb-4 border-b border-gray-700">
                    <ul class="flex flex-wrap -mb-px text-sm font-medium text-center" id="expensesTab" role="tablist">
                        <li role="presentation">
                            <button class="tab-button inline-block p-4 border-b-2 rounded-t-lg text-blue-500 border-blue-500" id="category-tab" data-tab-target="#category-content" type="button" role="tab">По категориям</button>
                        </li>
                        <li role="presentation">
                            <button class="tab-button inline-block p-4 border-b-2 rounded-t-lg text-gray-400 border-gray-700 hover:bg-gray-700 hover:border-gray-600" id="store-tab" data-tab-target="#store-content" type="button" role="tab">По магазинам</button>
                        </li>
                    </ul>
                </div>
                <div id="expensesTabContent">
                    <div class="tab-content" id="category-content" role="tabpanel">
                        <h3 class="text-2xl font-bold text-center mb-4 text-white">Структура расходов</h3>
                        <div class="relative h-[35vh] w-full max-w-[450px] mx-auto">
                            <canvas id="expensesChart"></canvas>
                        </div>
                        <div id="expensesLegend" class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-x-4"></div>
                        <button id="detectAnomaliesButton" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-4 rounded-md transition duration-300 text-lg mt-4">Найти аномалии в данных</button>
                    </div>
                    <div class="tab-content hidden" id="store-content" role="tabpanel">
                        <h3 class="text-2xl font-bold text-center mb-4 text-white">Топ-10 трат по магазинам и сервисам</h3>
                        <div class="relative h-[45vh] w-full">
                            <canvas id="storesChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Правая колонка с двумя карточками -->
            <div class="flex flex-col gap-8 md:gap-12">
                <!-- Карточка источников дохода -->
                <div class="bg-[#161b22] rounded-2xl p-6 text-left transition-all duration-300 border border-[#30363d] hover:translate-y-[-5px] hover:shadow-lg hover:shadow-black/30 hover:border-[#8b5cf6] flex-1">
                    <h3 class="text-2xl font-bold text-center mb-6 text-white">Источники дохода</h3>
                    <div class="space-y-4" id="incomeList">
                        <!-- Income bars will be generated by JS -->
                    </div>
                </div>

                <!-- Прогресс по цели -->
                <div class="bg-[#161b22] rounded-2xl p-6 text-left transition-all duration-300 border border-[#30363d] hover:translate-y-[-5px] hover:shadow-lg hover:shadow-black/30 hover:border-[#8b5cf6] flex-1">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-2xl font-bold text-white">Прогресс по цели</h3>
                        <button id="setupGoalButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 text-sm">Настроить</button>
                    </div>
                    <p id="goalDescription" class="text-gray-400">Цель не задана</p>
                    <div class="w-full bg-gray-600 rounded-full h-4 mt-4">
                        <div id="goalProgressBar" class="bg-blue-500 h-4 rounded-full" style="width: 0%;"></div>
                    </div>
                <div class="flex justify-between text-sm font-semibold mt-2">
                        <span id="goalProgressText" class="text-white">0%</span>
                        <span id="goalTargetText" class="text-gray-400">Цель: -</span>
                    </div>
                    <p id="comparisonMonthText" class="text-sm text-gray-400 mt-1"></p>
                </div>
            </div>
        </section>

        <!-- Секция планирования бюджета -->
        <section id="budgetPlanningSection" class="bg-[#161b22] rounded-2xl p-6 text-left transition-all duration-300 border border-[#30363d] hover:translate-y-[-5px] hover:shadow-lg hover:shadow-black/30 hover:border-[#8b5cf6] mt-8 md:mt-12 mb-8 md:mb-12">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold text-white">Планирование бюджета на месяц</h3>
                <button id="toggleBudgetVisibility" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">
                    Скрыть/Показать
                </button>
            </div>
            <div id="budgetContent">
                <div class="flex flex-wrap items-center gap-4 mb-4">
                    <input type="number" id="plannedIncome" placeholder="Планируемый доход" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full md:w-auto p-2.5">
                    <button id="calculateBudgetButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Рассчитать</button>
                    <button id="saveBudgetButton" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">Сохранить на месяц</button>
                </div>
                <div id="budgetResult" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Результаты расчета бюджета будут здесь -->
                </div>
            </div>
        </section>

        <!-- Секция графика "Траты vs. Доходы" -->
        <section id="spendIncomeTrendSection" class="bg-[#161b22] rounded-2xl p-6 text-left transition-all duration-300 border border-[#30363d] hover:translate-y-[-5px] hover:shadow-lg hover:shadow-black/30 hover:border-[#8b5cf6] mb-8 md:mb-12">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold text-white">Траты vs. Доходы</h3>
                <button id="toggleSpendIncomeVisibility" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">
                    Скрыть/Показать
                </button>
            </div>
            <div id="spendIncomeContent">
                <p class="text-gray-400 text-sm mb-2">Среднедневной доход: <span id="avgDailyIncome" class="font-semibold text-green-400">0.00 грн</span></p>
                <p class="text-gray-400 text-sm mb-4">Среднедневная трата: <span id="avgDailyExpenses" class="font-semibold text-red-400">0.00 грн</span></p>
                <div class="h-96">
                    <canvas id="spendIncomeTrendChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Секция аномалий -->
        <section id="anomaliesSection" class="bg-[#161b22] rounded-2xl p-6 text-left transition-all duration-300 border border-[#30363d] hover:translate-y-[-5px] hover:shadow-lg hover:shadow-black/30 hover:border-[#8b5cf6] mb-8 md:mb-12">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold text-white">Аномалии</h3>
                <button id="toggleAnomaliesVisibility" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">
                    Скрыть/Показать
                </button>
            </div>
            <div id="anomaliesContent">
                <p class="text-gray-400 text-sm mb-4">Нетипичные или крупные траты</p>
                <div id="anomaliesList" class="space-y-3">
                    <!-- Anomalies will be listed here -->
                    <p class="text-gray-500">Аномалий не найдено.</p>
                </div>
                <div id="anomaliesPagination" class="flex justify-center items-center mt-4 space-x-2">
                    <button id="prevAnomalyPage" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">Предыдущая</button>
                    <span id="anomalyPageInfo" class="text-gray-400">Страница 1 из 1</span>
                    <button id="nextAnomalyPage" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">Следующая</button>
                </div>
            </div>
        </section>

    <!-- Секция таблицы транзакций -->
    <section id="transactionsSection" class="bg-[#161b22] rounded-2xl p-6 text-left transition-all duration-300 border border-[#30363d] hover:translate-y-[-5px] hover:shadow-lg hover:shadow-black/30 hover:border-[#8b5cf6] mt-8 md:mt-12">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold text-white">Последние транзакции</h2>
            <button id="toggleTransactionsVisibility" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">
                Скрыть/Показать
            </button>
        </div>
        <div id="transactionsContent">
            <div class="overflow-x-auto">
                <table class="w-full border-collapse">
                    <thead>
                        <tr>
                            <th class="p-3 md:p-4 border-b border-gray-700 text-left bg-gray-800 font-semibold text-gray-400 cursor-pointer" id="sortDate" data-sort-key="date" data-sort-direction="desc">Дата <span id="sortDateArrow">↓</span></th>
                            <th class="p-3 md:p-4 border-b border-gray-700 text-left bg-gray-800 font-semibold text-gray-400">Категория</th>
                            <th class="p-3 md:p-4 border-b border-gray-700 text-left bg-gray-800 font-semibold text-gray-400">Контрагент</th>
                            <th class="p-3 md:p-4 border-b border-gray-700 text-left bg-gray-800 font-semibold text-gray-400">Сумма</th>
                            <th class="p-3 md:p-4 border-b border-gray-700 text-left bg-gray-800 font-semibold text-gray-400">Счет</th>
                        </tr>
                    </thead>
                    <tbody id="transactionsTableBody">
                        <!-- Rows will be generated by JS -->
                    </tbody>
                </table>
            </div>
            <div id="transactionsPagination" class="flex justify-center items-center mt-4 space-x-2">
                <button id="prevTransactionPage" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">Предыдущая</button>
                <span id="transactionPageInfo" class="text-gray-400">Страница 1 из 1</span>
                <button id="nextTransactionPage" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">Следующая</button>
            </div>
        </div>
    </section>


    <!-- Секция глубокого анализа -->
    <section id="deepAnalysisSection" class="bg-[#161b22] rounded-2xl p-6 text-left transition-all duration-300 border border-[#30363d] hover:translate-y-[-5px] hover:shadow-lg hover:shadow-black/30 hover:border-[#8b5cf6] mt-8 md:mt-12">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold text-white">Глубокий анализ трат</h2>
            <button id="toggleDeepAnalysisVisibility" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">
                Скрыть/Показать
            </button>
        </div>
        <div id="deepAnalysisContent">
            <p class="text-gray-400 mb-2">Получите подробный анализ ваших трат за выбранный месяц с помощью ИИ.</p>
            <p class="text-gray-500 text-sm mb-4">Анализ будет проведен для месяца и года, выбранных в разделе "Настройки отображения" выше.</p>
            <div class="flex flex-wrap gap-4 mb-4">
                <button id="deepAnalysisButton" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-md transition duration-300 text-lg">Провести глубокий анализ</button>
                <button id="deepAnalysisSettingsButton" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-md transition duration-300 text-lg">Настроить анализ</button>
            </div>
            <div id="analysisResult" class="mt-6 p-4 bg-gray-800 rounded-lg text-gray-200 whitespace-pre-wrap">
                <!-- Analysis results will be displayed here -->
            </div>
            <div id="analysisLoading" class="hidden mt-4 text-center text-blue-400">
                <p>Анализ выполняется, пожалуйста, подождите...</p>
            </div>
        </div>
    </section>

    <!-- Модальное окно настроек глубокого анализа -->
    <div id="deepAnalysisSettingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 backdrop-blur-sm">
        <div class="bg-[#161b22] p-6 rounded-2xl border border-[#30363d] max-w-lg w-full shadow-2xl shadow-black/50">
            <h2 class="text-2xl font-bold text-white mb-4">Настройки глубокого анализа</h2>
            <div class="space-y-4">
                <div>
                    <label class="block mb-2 text-sm font-medium text-gray-300">Период анализа</label>
                    <div class="flex gap-2">
                        <select id="deepAnalysisMonth" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                            <option value="">Весь год</option>
                            <option value="01">Январь</option>
                            <option value="02">Февраль</option>
                            <option value="03">Март</option>
                            <option value="04">Апрель</option>
                            <option value="05">Май</option>
                            <option value="06">Июнь</option>
                            <option value="07">Июль</option>
                            <option value="08">Август</option>
                            <option value="09">Сентябрь</option>
                            <option value="10">Октябрь</option>
                            <option value="11">Ноябрь</option>
                            <option value="12">Декабрь</option>
                        </select>
                        <input type="number" id="deepAnalysisYear" placeholder="Год" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                    </div>
                </div>
                <div>
                    <label for="deepAnalysisCategory" class="block mb-2 text-sm font-medium text-gray-300">Категория для сравнительного анализа (опционально)</label>
                    <input type="text" id="deepAnalysisCategory" placeholder="Например: Кафе и рестораны" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                </div>
                <div>
                    <label for="deepAnalysisModel" class="block mb-2 text-sm font-medium text-gray-300">Модель ИИ для анализа</label>
                    <select id="deepAnalysisModel" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                        <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
                        <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
                        <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
                    </select>
                </div>
            </div>
            <div class="flex justify-end gap-4 mt-6">
                <button id="closeDeepAnalysisSettingsButton" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">Отмена</button>
                <button id="saveDeepAnalysisSettingsButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Сохранить</button>
            </div>
        </div>
    </div>

    <!-- Секция анализа привычек -->
    <section class="bg-[#161b22] rounded-2xl p-6 text-left transition-all duration-300 border border-[#30363d] hover:translate-y-[-5px] hover:shadow-lg hover:shadow-black/30 hover:border-[#8b5cf6] mt-8 md:mt-12">
        <h2 class="text-2xl font-bold text-white mb-4">Анализ привычек</h2>
        <p class="text-gray-400 mb-4">Здесь отображаются ваши регулярные траты, которые могут считаться привычками.</p>
        <div id="habitsResult" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4">
            <!-- Habit cards will be displayed here -->
        </div>
        <div id="habitsLoading" class="hidden mt-4 text-center text-blue-400">
            <p>Анализ привычек, пожалуйста, подождите...</p>
        </div>
        <div id="habitsPagination" class="flex justify-center items-center mt-4 space-x-2">
            <button id="prevHabitPage" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">Предыдущая</button>
            <span id="habitPageInfo" class="text-gray-400">Страница 1 из 1</span>
            <button id="nextHabitPage" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">Следующая</button>
        </div>
    </section>

    <!-- Секция кредитов -->
    <section class="bg-[#161b22] rounded-2xl p-6 text-left transition-all duration-300 border border-[#30363d] hover:translate-y-[-5px] hover:shadow-lg hover:shadow-black/30 hover:border-[#8b5cf6] mt-8 md:mt-12">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold text-white">Мои кредиты</h2>
            <button id="addLoanButton" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md transition duration-300">Добавить кредит</button>
        </div>
        <p class="text-gray-400 mb-4">Отслеживайте ваши кредиты, платежи и остатки задолженности.</p>
        <div id="loansList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- Кредиты будут отображаться здесь -->
        </div>
        <div id="loansLoading" class="hidden mt-4 text-center text-blue-400">
            <p>Загрузка кредитов, пожалуйста, подождите...</p>
        </div>
    </section>

    <!-- Секция кредитных карт -->
    <section class="bg-[#161b22] rounded-2xl p-6 text-left transition-all duration-300 border border-[#30363d] hover:translate-y-[-5px] hover:shadow-lg hover:shadow-black/30 hover:border-[#8b5cf6] mt-8 md:mt-12">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold text-white">Кредитные карты</h2>
            <button id="addCreditCardButton" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md transition duration-300">Добавить карту</button>
        </div>
        <p class="text-gray-400 mb-4">Управляйте льготными периодами и отслеживайте задолженность по кредитным картам.</p>
        <div id="creditCardsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- Кредитные карты будут отображаться здесь -->
        </div>
        <div id="creditCardsLoading" class="hidden mt-4 text-center text-blue-400">
            <p>Загрузка кредитных карт, пожалуйста, подождите...</p>
        </div>
    </section>

    <!-- Секция анализа использования карт -->
    <section id="cardUsageAnalysisSection" class="bg-[#161b22] rounded-2xl p-6 text-left transition-all duration-300 border border-[#30363d] hover:translate-y-[-5px] hover:shadow-lg hover:shadow-black/30 hover:border-[#8b5cf6] mt-8 md:mt-12">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold text-white">Использование карт по категориям</h2>
            <div class="flex gap-2">
                <button id="showCardCategoriesButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">
                    Категории
                </button>
                <button id="showCardUsageMainButton" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">
                    По транзакциям
                </button>
                <button id="toggleCardUsageVisibility" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">
                    Скрыть/Показать
                </button>
            </div>
        </div>
        <div id="cardUsageContent">
            <div id="cardUsageMainContent">
                <p class="text-gray-400 mb-4">Здесь отображается, какие карты вы чаще всего используете для определенных категорий трат.</p>
                <div id="cardUsageAnalysisResult" class="space-y-4">
                    <!-- Результаты анализа использования карт будут здесь -->
                </div>
                <div id="cardUsageAnalysisLoading" class="hidden mt-4 text-center text-blue-400">
                    <p>Анализ использования карт, пожалуйста, подождите...</p>
                </div>
            </div>
            <div id="cardCategoriesContent" class="hidden">
                <p class="text-gray-400 mb-4">Список категорий и наиболее используемых карт для каждой категории.</p>
                <div id="cardCategoriesList" class="space-y-4">
                    <!-- Список категорий и карт будет здесь -->
                </div>
                <div id="cardCategoriesLoading" class="hidden mt-4 text-center text-blue-400">
                    <p>Загрузка категорий, пожалуйста, подождите...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Модальное окно добавления кредита -->
    <div id="addLoanModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 backdrop-blur-sm">
        <div class="bg-[#161b22] p-6 rounded-2xl border border-[#30363d] max-w-lg w-full shadow-2xl shadow-black/50">
            <h2 class="text-2xl font-bold text-white mb-4">Добавить кредит</h2>
            <form id="addLoanForm" class="space-y-4">
                <div>
                    <label for="loanName" class="block mb-2 text-sm font-medium text-gray-300">Название кредита</label>
                    <input type="text" id="loanName" placeholder="Например: Ипотека, Автокредит" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                </div>
                <div>
                    <label for="loanPrincipal" class="block mb-2 text-sm font-medium text-gray-300">Основная сумма (грн)</label>
                    <input type="number" id="loanPrincipal" step="0.01" required class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                </div>
                <div>
                    <label for="loanInterestRate" class="block mb-2 text-sm font-medium text-gray-300">Процентная ставка (%)</label>
                    <input type="number" id="loanInterestRate" step="0.01" required class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                </div>
                <div>
                    <label for="loanTermMonths" class="block mb-2 text-sm font-medium text-gray-300">Срок в месяцах</label>
                    <input type="number" id="loanTermMonths" required class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                </div>
                <div>
                    <label for="loanStartDate" class="block mb-2 text-sm font-medium text-gray-300">Дата открытия</label>
                    <input type="date" id="loanStartDate" required class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                </div>
                <div>
                    <label for="loanPaidAmount" class="block mb-2 text-sm font-medium text-gray-300">Уже выплачено (грн)</label>
                    <input type="number" id="loanPaidAmount" step="0.01" value="0" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                </div>
            </form>
            <div class="flex justify-end gap-4 mt-6">
                <button id="closeAddLoanModalButton" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">Отмена</button>
                <button id="saveLoanButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Сохранить</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно добавления кредитной карты -->
    <div id="addCreditCardModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 backdrop-blur-sm">
        <div class="bg-[#161b22] p-6 rounded-2xl border border-[#30363d] max-w-lg w-full shadow-2xl shadow-black/50">
            <h2 class="text-2xl font-bold text-white mb-4">Добавить кредитную карту</h2>
            <form id="addCreditCardForm" class="space-y-4">
                <div>
                    <label for="cardName" class="block mb-2 text-sm font-medium text-gray-300">Название карты</label>
                    <input type="text" id="cardName" required class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                </div>
                <div>
                    <label for="gracePeriodDays" class="block mb-2 text-sm font-medium text-gray-300">Льготный период (дней)</label>
                    <input type="number" id="gracePeriodDays" required class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                </div>
                <div>
                    <label for="statementDay" class="block mb-2 text-sm font-medium text-gray-300">День выписки (1-31, опционально)</label>
                    <input type="number" id="statementDay" min="1" max="31" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                </div>
                <div>
                    <label for="paymentDueDay" class="block mb-2 text-sm font-medium text-gray-300">День платежа (1-31, опционально)</label>
                    <input type="number" id="paymentDueDay" min="1" max="31" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                </div>
                <div>
                    <label for="firstTransactionDate" class="block mb-2 text-sm font-medium text-gray-300">Дата первой операции</label>
                    <input type="date" id="firstTransactionDate" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                    <p class="text-xs text-gray-400 mt-1">Дата первой покупки по карте (для расчета льготного периода)</p>
                </div>
                <div>
                    <label for="unpaidBalance" class="block mb-2 text-sm font-medium text-gray-300">Текущая задолженность (грн)</label>
                    <input type="number" id="unpaidBalance" step="0.01" value="0" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                </div>
            </form>
            <div class="flex justify-end gap-4 mt-6">
                <button id="closeAddCreditCardModalButton" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">Отмена</button>
                <button id="saveCreditCardButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Сохранить</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно деталей привычки -->
    <div id="habitDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-[#1f2937] p-6 rounded-lg border border-[#374151] max-w-2xl w-full">
            <h2 id="habitDetailTitle" class="text-2xl font-bold text-white mb-4">Подробности привычки</h2>
            <div class="chart-container" style="height: 40vh;">
                <canvas id="habitTrendChart"></canvas>
            </div>
            <button id="closeHabitDetailModal" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Закрыть</button>
        </div>
    </div>

    <!-- Модальное окно настройки цели -->
    <div id="goalSetupModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="bg-[#161b22] p-6 rounded-2xl border border-[#30363d] max-w-lg w-full shadow-2xl shadow-black/50">
            <h2 class="text-2xl font-bold text-white mb-4">Настройка цели</h2>
            <div class="mb-4 border-b border-gray-700">
                <ul class="flex flex-wrap -mb-px text-sm font-medium text-center" id="goalTab" role="tablist">
                    <li role="presentation">
                        <button class="goal-tab-button inline-block p-4 border-b-2 rounded-t-lg text-blue-500 border-blue-500" data-tab-target="#manualGoalSetup">Задать вручную</button>
                    </li>
                    <li role="presentation">
                        <button class="goal-tab-button inline-block p-4 border-b-2 rounded-t-lg text-gray-400 border-transparent hover:text-gray-300 hover:border-gray-300" data-tab-target="#recommendedGoalSetup">Получить рекомендацию</button>
                    </li>
                </ul>
            </div>
            <div id="goalTabContent">
                <div class="goal-tab-content" id="manualGoalSetup">
                    <div class="space-y-4">
                        <div>
                            <label for="goalCategory" class="block mb-2 text-sm font-medium text-gray-300">Категория расходов</label>
                            <select id="goalCategory" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                                <!-- Options will be populated by JS -->
                            </select>
                        </div>
                        <div>
                            <label for="goalType" class="block mb-2 text-sm font-medium text-gray-300">Тип цели</label>
                            <select id="goalType" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                                <option value="reduce">Сократить расходы на (в %)</option>
                                <option value="limit">Потратить не более (в грн)</option>
                            </select>
                        </div>
                        <div>
                            <label for="goalValue" class="block mb-2 text-sm font-medium text-gray-300">Значение</label>
                            <input type="number" id="goalValue" placeholder="Например: 15" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                        </div>
                    </div>
                </div>
                <div class="goal-tab-content hidden" id="recommendedGoalSetup">
                    <p class="text-gray-400 mb-4">Нажмите кнопку, чтобы получить рекомендацию по цели на основе вашего анализа трат.</p>
                    <button id="getGoalRecommendationButton" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">Получить рекомендацию</button>
                    <div id="recommendationResult" class="mt-4 p-4 bg-gray-800 rounded-lg hidden">
                        <!-- Recommendation will be displayed here -->
                    </div>
                </div>
            </div>
            <div class="flex justify-end gap-4 mt-6">
                <button id="closeGoalModalButton" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">Закрыть</button>
                <button id="saveGoalButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Сохранить</button>
            </div>
        </div>
    </div>

    </div>

    <!-- Модальное окно настроек -->
<div id="settingsModal" class="fixed inset-0 bg-black bg-opacity50 hidden items-center justify-center z-50 backdrop-blur-sm">
    <div class="bg-[#161b22] p-6 rounded-2xl border border-[#30363d] max-w-lg w-full shadow-2xl shadow-black/50">
        <h2 class="text-2xl font-bold text-white mb-4">Настройки</h2>
        <div class="space-y-4">
            <div>
                <label class="block mb-2 text-sm font-medium text-gray-300">Тема</label>
                <div class="flex gap-2">
                    <button id="lightThemeButton" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded">Светлая</button>
                    <button id="darkThemeButton" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded">Темная</button>
                </div>
            </div>
            <div>
                <label class="block mb-2 text-sm font-medium text-gray-300">Язык</label>
                <div class="flex gap-2">
                    <button id="ruLangButton" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded">Русский</button>
                    <button id="enLangButton" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded">English</button>
                </div>
            </div>
            <div id="file-upload-section">
                <h2 class="text-2xl font-bold text-white mb-4">Обновить данные из файла</h2>
                <p class="text-gray-400 mb-4">Загрузите CSV-файл, чтобы добавить новые транзакции в базу данных. Существующие транзакции будут проигнорированы.</p>
                <input type="file" id="csvFile" accept=".csv" class="w-full p-4 bg-gray-700 text-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">
                <div class="flex items-center mb-4 p-4 bg-gray-800 rounded-lg">
                    <input id="excludeDebtsOnUpload" type="checkbox" class="w-5 h-5 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500">
                    <label for="excludeDebtsOnUpload" class="ml-3 text-lg font-medium text-gray-300">Исключить категорию "Долги" при загрузке</label>
                </div>
                <div class="flex items-center mb-4 p-4 bg-gray-800 rounded-lg">
                    <input id="skipEmbeddingOnUpload" type="checkbox" class="w-5 h-5 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500">
                    <label for="skipEmbeddingOnUpload" class="ml-3 text-lg font-medium text-gray-300">Не генерировать эмбеддинги при загрузке (для экономии квоты)</label>
                </div>
                <button id="processDataButton" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-md transition duration-300 text-lg">Загрузить в базу данных</button>
            </div>
        </div>
        <div class="flex justify-end gap-4 mt-6">
            <button id="closeSettingsModalButton" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">Закрыть</button>
        </div>
    </div>
</div>

    <script src="script.js"></script>

</body>
</html>
