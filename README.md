# Универсальный Финансовый Отчет

Это веб-приложение представляет собой интерактивную панель для анализа личных финансов. Оно позволяет загружать CSV-файл с данными о транзакциях, визуализировать структуру доходов и расходов, выполнять семантический поиск и кластеризовать транзакции для выявления скрытых закономерностей.

## Возможности

*   **Загрузка CSV**: Простая загрузка и обработка вашего CSV-файла с финансовыми данными.
*   **Фильтрация данных**:
    *   **Исключение "Долгов"**: Возможность исключить транзакции, связанные с долговыми счетами.
    *   **Фильтр по дате**: Фильтрация данных по конкретному месяцу и/или году.
*   **Финансовая сводка**: Автоматический расчет и отображение общего дохода, общих расходов и чистого баланса.
*   **Визуализация расходов**:
    *   **По категориям**: Интерактивная кольцевая диаграмма, показывающая распределение расходов по категориям.
    *   **По магазинам**: Горизонтальная столбчатая диаграмма с топ-10 тратами по магазинам и сервисам.
*   **Анализ доходов**: Наглядное отображение источников дохода и их долей в общей сумме.
*   **Семантический поиск**: Поиск транзакций по смыслу, используя эмбеддинги, сгенерированные AI.
*   **Кластеризация HDBSCAN**: Автоматическая группировка похожих транзакций на основе их числовых значений и семантических эмбеддингов. Результаты кластеризации сохраняются в базе данных и визуализируются.

## Как использовать

1.  **Настройка Supabase**:
    *   Убедитесь, что у вас есть база данных Supabase с таблицей `transactions`.
    *   Добавьте колонку `cluster_id` в вашу таблицу `transactions`, выполнив следующий SQL-запрос в SQL Editor Supabase:
        ```sql
        ALTER TABLE transactions
        ADD COLUMN cluster_id INT;
        ```
2.  **Развертывание на Vercel**:
    *   Разверните этот проект на Vercel. Vercel автоматически обнаружит API-маршруты в директории `api/`.
    *   Убедитесь, что переменные окружения `SUPABASE_URL`, `SUPABASE_ANON_KEY` и `GEMINI_API_KEY` настроены в вашем проекте Vercel.
3.  **Откройте приложение**: Откройте URL вашего развернутого приложения на Vercel.
4.  **Загрузите CSV-файл**: Нажмите на кнопку выбора файла и загрузите ваш CSV-файл с транзакциями.
    *   **Формат CSV**: Убедитесь, что ваш файл использует точку с запятой (`;`) в качестве разделителя и содержит заголовки, соответствующие формату экспорта из приложения [ZenMoney](https://zenmoney.ru/). Пример необходимых заголовков: `date;categoryName;payee;comment;outcomeAccountName;outcome;outcomeCurrencyShortTitle;incomeAccountName;income;incomeCurrencyShortTitle;createdDate;changedDate;qrCode`.
5.  **Примените фильтры (опционально)**:
    *   Установите флажок "Исключить 'Долги'", чтобы убрать долговые операции.
    *   Выберите месяц и/или введите год для анализа конкретного периода.
6.  **Запустите кластеризацию**: В секции "Кластеризация транзакций (HDBSCAN)" нажмите кнопку "Запустить кластеризацию". Результаты будут сохранены в Supabase и отображены на круговой диаграмме.
7.  **Используйте семантический поиск**: Введите запрос в поле "Семантический поиск по транзакциям" и нажмите "Найти", чтобы найти похожие транзакции.
8.  **Изучите отчет**: Просмотрите сводку, диаграммы и результаты поиска/кластеризации на панели.

## Структура проекта

*   `index.html`: Основной файл, содержащий всю структуру, стили (Tailwind CSS) и логику фронтенда (JavaScript).
*   `api/`: Директория, содержащая Vercel Serverless Functions (API-маршруты):
    *   `api/get-transactions.js`: Получение транзакций из Supabase.
    *   `api/upload-transactions.js`: Загрузка транзакций в Supabase, включая генерацию эмбеддингов.
    *   `api/semantic-search.js`: Выполнение семантического поиска по транзакциям.
    *   `api/cluster-transactions.js`: Выполнение кластеризации HDBSCAN и сохранение результатов.
*   `README.md`: Этот файл.
*   `package.json`: Описание проекта и его зависимостей.
*   `package-lock.json`: Зафиксированные версии зависимостей.
*   `supabase_vector_setup.sql`: SQL-скрипт для настройки векторного поиска в Supabase.

## Используемые технологии

*   HTML5
*   [Tailwind CSS](https://tailwindcss.com/)
*   JavaScript (ES6+)
*   [Chart.js](https://www.chartjs.org/)
*   [Google Gemini API](https://ai.google.dev/) (используемая модель: `embedding-001` для эмбеддингов)
*   [Supabase](https://supabase.com/) (как база данных и векторное хранилище)
*   [Vercel](https://vercel.com/) (для развертывания Serverless Functions и фронтенда)
*   [hdbscan-ts](https://www.npmjs.com/package/hdbscan-ts) (для кластеризации HDBSCAN)
